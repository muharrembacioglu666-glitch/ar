<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Projesi - Black Cube v1.6.0</title>
    
    <!-- AR.js ve A-Frame Kütüphaneleri -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; }
        
        /* UI Katmanı */
        #ui-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 999; pointer-events: none;
            font-family: sans-serif;
        }
        
        #status-box {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9); color: #000;
            padding: 10px 20px; border-radius: 30px; border: 2px solid #000;
            text-align: center; font-weight: bold; font-size: 1rem;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .debug-info {
            position: absolute; top: 10px; left: 10px;
            color: white; background: rgba(0,0,0,0.5); padding: 5px; font-size: 12px;
        }
    </style>

    <script>
        // UI GÜNCELLEME BİLEŞENİ
        AFRAME.registerComponent('sticky-marker', {
            init: function () {
                const marker = this.el;
                const statusBox = document.getElementById('status-box');

                marker.addEventListener('markerFound', function () {
                    statusBox.innerText = "KÜP YERLEŞTİRİLDİ! Kamerayı Çevirebilirsin.";
                    statusBox.style.borderColor = "#000";
                    statusBox.style.color = "#fff";
                    statusBox.style.background = "#000";
                });
            }
        });

        // NESNEYİ MARKER'DAN KOPARIP SAHNEYE YAPIŞTIRAN KOD (STICKY LOGIC)
        AFRAME.registerComponent('detach-on-load', {
            init: function () {
                const object = this.el;
                const scene = document.querySelector('a-scene');
                
                // Başlangıçta gizle ki marker bulunmadan havada bir şey görmeyelim
                object.setAttribute('visible', false);

                // Marker'ı bul (Bu sefer type='pattern' olanı bulacak)
                const marker = document.querySelector('a-marker');

                marker.addEventListener('markerFound', () => {
                    // Eğer nesne hala marker'a bağlıysa, onu oradan kopar
                    if (object.parentNode === marker) {
                        
                        // 1. Dünya üzerindeki tam konumunu kopyala
                        let worldPos = new THREE.Vector3();
                        let worldQuat = new THREE.Quaternion();
                        let worldScale = new THREE.Vector3();
                        
                        object.object3D.getWorldPosition(worldPos);
                        object.object3D.getWorldQuaternion(worldQuat);
                        object.object3D.getWorldScale(worldScale);

                        // 2. Marker'ın içinden sil, Sahnenin (Scene) içine ekle
                        marker.removeChild(object);
                        scene.appendChild(object);

                        // 3. Konumu geri yükle (Artık bağımsız)
                        object.object3D.position.copy(worldPos);
                        object.object3D.quaternion.copy(worldQuat);
                        object.object3D.scale.copy(worldScale);
                        
                        // Nesneyi görünür yap
                        object.setAttribute('visible', true);
                    }
                });
            }
        });
    </script>
</head>

<body>
    <div id="ui-layer">
        <div class="debug-info">v1.6.0 - Custom Pattern</div>
        <div id="status-box">QR Kodunu Göster...</div>
    </div>

    <!-- AR SAHNESİ -->
    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
        vr-mode-ui="enabled: false">

        <!-- SENİN ÖZEL MARKER'IN -->
        <!-- Dosya yolunun 'qr/pattern-ar_projesi.patt' olduğundan %100 emin ol -->
        <a-marker type="pattern" url="qr/pattern-ar_projesi.patt" sticky-marker>
            
            <!-- detach-on-load: Bu özellik küpü yapışkan yapar -->
            <a-entity id="my-ar-object" detach-on-load>
                
                <!-- SİYAH KÜP -->
                <a-box 
                    position="0 0.5 0" 
                    scale="0.6 0.6 0.6" 
                    material="color: #000000; opacity: 1;"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 8000">
                </a-box>
                
                <!-- Küpün siyah olduğunu belli etmek için beyaz kenarlık (Opsiyonel Estetik) -->
                <a-box 
                    position="0 0.5 0" 
                    scale="0.61 0.61 0.61" 
                    material="color: #ffffff; wireframe: true;">
                </a-box>

            </a-entity>

        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
